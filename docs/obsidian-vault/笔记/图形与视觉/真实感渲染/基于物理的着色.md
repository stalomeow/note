---
date: "2025-02-10T18:17:44"
---

# 基于物理的着色

材质（Material）描述的是光到物体表面后如何被反射，就是 [[渲染方程#BRDF|渲染方程中的 BRDF]]。

## Diffuse / Lambertian Material

![[Pasted image 20250210202116.png|Diffuse / Lambertian Material]]

光会均匀地被反射到各个方向。假设各个方向的入射光也是一样的，那么 $f_r(\omega_i,\omega_o)$、$L_i(\omega_i)$ 和 $L_o(\omega_o)$ 都是常量

$$
\begin{align}
L_o(\omega_o)&=\int_{H^2} f_r L_i \cos \theta_i \mathrm{d}\omega_i\\
\\
&=f_r L_i \int_{H^2} \cos \theta_i \mathrm{d}\omega_i\\
\\
&=\pi f_r L_i
\end{align}
$$

其中 $H^2$ 是法线方向的半球。如果表面的反照率（Albedo/Color）是 $\rho$，那么有 $L_o=\rho L_i$，所以

$$
f_r=\frac{\rho}{\pi}
$$

## Glossy Material

![[Pasted image 20250210204454.png|Glossy Material]]

## Ideal Reflective / Refractive Material

![[Pasted image 20250210205307.png|Ideal Reflective / Refractive Material]]

光会发生反射和折射。使用 BRDF 描述反射，BTDF (Bidirectional Transmittance Distribution Function) 描述折射，两个加起来称为 BSDF (Bidirectional Scattering Distribution Function)，即 BSDF = BRDF + BTDF。

## Perfect Specular Reflection

![[Pasted image 20250210210052.png|Perfect Specular Reflection]]

反射角等于入射角 $\theta_o=\theta_i=\theta$

$$
\omega_o+\omega_i=2 \cos \theta \ \vec{n} = 2 (\omega_i \cdot \vec{n})\vec{n}
$$

所以

$$
\omega_o=-\omega_i + 2 (\omega_i \cdot \vec{n})\vec{n}
$$

## Snell's Law

![[Pasted image 20250210210626.png|Snell's Law]]

入射角 $\theta_i$ 和折射角 $\theta_t$ 满足

$$
\eta_i \sin \theta_i = \eta_t \sin \theta_t
$$

其中 $\eta_i,\eta_t$ 是两种介质的折射率。

$$
\cos \theta_t = \sqrt{1 - \left(\frac{\eta_i}{\eta_t} \right)^2 (1-\cos^2 \theta_i)}
$$

当 $\dfrac{\eta_i}{\eta_t}>1$ 时，如果 $\theta_i$ 足够大，上式根号里的部分就会小于 0，所以当光从光密介质进入光疏介质，且入射角足够大时，会发生全反射（Total Internal Reflection）。

![[Pasted image 20250210212240.png|Snell’s Window / Circle]]

## Fresnel Reflection / Term

![[Pasted image 20250210214518.png|Reflectance depends on incident angle (and polarization of light)]]

反射现象和光的入射角以及偏振有关，入射角越大，反射越强。又因为反射角等于入射角，所以视线越靠近表面，看到的反射越强。

> [!NOTE]- Grazing Angle
> 掠射角（Grazing Angle）指的是与入射角互余的角，即光与表面切线的夹角。另一方面，当入射角接近 90 度时，称为「掠射」，所以很多时候掠射角仅表示入射光非常接近表面的时候。
>
> ![[Pasted image 20250210214719.png|Grazing and Incidence Angles]]
>
> > "Graze" and "grazing" in English refer to animals eating grass close to the ground, and from that, "to graze" can also mean "to touch lightly the surface of an object in passing."
> >
> > Describing an angle between two objects moving past each other as "grazing" would imply that the angle is small because they almost touched.
> >
> > So in graphics, the "90-degree complement to the angle of incidence" is generally only referred to as a "grazing angle" when, like you said, the angle of the light traveling above the surface is very small, almost parallel to that surface. [^1]

![[Pasted image 20250210220503.png|Fresnel Term]]

 给定入射角 $\theta_i$，Fresnel Term 给出了对应的反射率。上图中，左边是绝缘体（Dielectric），右边是导体（Conductor）。

![[Pasted image 20250210220921.png|Fresnel Term]]

$$
\begin{align}
R_s &= \left|\frac{n_1 \cos \theta_i - n_2 \cos \theta_t}{n_1 \cos \theta_i + n_2 \cos \theta_t} \right|^2 = \left|\frac{n_1 \cos \theta_i - n_2 \sqrt{1-\left(\dfrac{n_1}{n_2} \sin \theta_i\right)^2}}{n_1 \cos \theta_i + n_2 \sqrt{1-\left(\dfrac{n_1}{n_2} \sin \theta_i\right)^2}} \right|^2\\
\\
R_p &= \left|\frac{n_1 \cos \theta_t - n_2 \cos \theta_i}{n_1 \cos \theta_t + n_2 \cos \theta_i} \right|^2 = \left|\frac{n_1 \sqrt{1-\left(\dfrac{n_1}{n_2} \sin \theta_i\right)^2} - n_2 \cos \theta_i}{n_1 \sqrt{1-\left(\dfrac{n_1}{n_2} \sin \theta_i\right)^2} + n_2 \cos \theta_i} \right|^2\\
\end{align}
$$

通常不考虑偏振（含有等量的 s 偏振和 p 偏振），那么反射比为

$$
R=\frac{1}{2}(R_s+R_p)
$$

这个公式太复杂，所以常用 Schlick’s approximation

$$
R(\theta)=R_0+(1-R_0)(1-\cos \theta)^5
$$

随着入射角 $\theta$ 变大，$R(\theta)$ 从初始值 $R_0$ 增大到 $1$。其中

$$
R_0=\left(\frac{n_1-n_2}{n_1+n_2}\right)^2
$$

## Microfacet Material

### Normal Distribution Function

### Shadowing-Masking Term

### The Kulla-Conty Approximation

[^1]: [Does "grazing angle" have a general definition? : r/computergraphics](https://www.reddit.com/r/computergraphics/comments/1hb3jtq/does_grazing_angle_have_a_general_definition/)
